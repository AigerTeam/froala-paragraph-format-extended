/**
 * A plugin for Froala Editor.
 * Allows users to choose paragraph format (tag name, class, etc.) from a list.
 *
 * @version 1.0
 * @author Finesse <i@f-ph.ru>
 * @license MIT
 * @see https://github.com/FinesseRus/froala-paragraph-format-extended More info
 */

!function(t){function a(t){var a="";return t.tag&&(a+=t.tag.toLowerCase()),t.id&&(a+="#"+t.id),t["class"]&&(a+=(t["class"]instanceof Array?t["class"]:String(t["class"]).split(/\s+/)).filter(function(t){return t}).sort().map(function(t){return"."+t}).join()),a}function e(t){var a=/([^\.#]*)(#[^\.]+|.{0})(\.[\s\S]+|.{0})/.exec(t);return a?{tag:a[1].toLowerCase()||null,id:a[2].slice(1)||null,"class":a[3].split(".").filter(function(t){return t}).join(" ")||null}:{}}t.FroalaEditor.DEFAULTS=t.extend(t.FroalaEditor.DEFAULTS,{paragraphFormatExt:[{title:"Normal"},{tag:"h1",title:"Heading 1"},{tag:"h2",title:"Heading 2"},{tag:"h3",title:"Heading 3"},{tag:"h4",title:"Heading 4"},{tag:"h4","class":"fr-text-bordered",title:"Header 4 bordered"},{tag:"pre",title:"Code"}],paragraphFormatExtSelection:!1}),t.FroalaEditor.PLUGINS.paragraphFormatExt=function(r){function n(a){var n=e(a),i=n.tag||r.html.defaultTag(),l=n["class"]||n.id;r.selection.save(),r.html.wrap(!0,!0,!0,!0),r.selection.restore();var o=t(r.selection.blocks()),u=o;r.selection.save(),r.$el.find("pre").attr("skip",!0),o.each(function(a,e){if(!r.node.isList(e)){var o,h,f=t(e);f.find(u).length||(h=f.is("li")?s:f.parent().is("li")?p:f.parent().is("td, th")?d:c,o=h(f,i,l),o&&(o.attr({"class":n["class"]||null,id:n.id||null}),u=u.add(o)))}}),r.$el.find('pre:not([skip="true"]) + pre:not([skip="true"])').each(function(){t(this).prev().append("<br>"+t(this).html()),t(this).remove()}),r.$el.find("pre").removeAttr("skip"),r.html.unwrap(),r.selection.restore()}function i(t){var a=r.selection.blocks(),e=o(a[0]).map(function(t){return'.fr-command[data-param1="'+t+'"]'}).join(", ");t.find(e).addClass("fr-active")}function l(t){if(r.opts.paragraphFormatExtSelection){for(var e=r.selection.blocks(),n=o(e[0]),i=r.opts.paragraphFormatExt,l="â€”",s=0;s<i.length;++s)if(-1!==n.indexOf(a(i[s]))){l=r.language.translate(i[s].title);break}t.find("> span").text(l)}}function o(e){var n,i,l=r.html.defaultTag();return e instanceof HTMLElement?(n={tag:e.tagName.toLowerCase(),id:e.getAttribute("id"),"class":e.getAttribute("class")},-1!==["li","td","th"].indexOf(n.tag)&&(n.tag=l)):n={tag:l},i=[n],n.tag===l&&i.push(t.extend({},n,{tag:null})),i.map(a)}function s(a,e,n){if(!(e&&e.toLowerCase()!==r.html.defaultTag()||n))return a;var i;if(a.find("ul, ol").length>0){i=t("<"+e+">"),a.prepend(i);for(var l=r.node.contents(a[0])[0];l&&-1===["ul","ol"].indexOf(l.tagName.toLowerCase());){var o=l.nextSibling;i.append(l),l=o}}else i=t("<"+e+">").html(a.html()),a.html(i);return i}function p(t,a,e){return a.toLowerCase()!==r.html.defaultTag()||e?c(t,a,e):(t.replaceWith(t.html()),null)}function d(t,a,e){return a.toLowerCase()!==r.html.defaultTag()||e?c(t,a,e):(r.node.isEmpty(t[0],!0)||t.append("<br/>"),t.replaceWith(t.html()),null)}function c(a,e){e||(e='div class="fr-temp-div"'+(r.node.isEmpty(a[0],!0)?' data-empty="true"':""));var n=t("<"+e+" "+r.node.attributes(a[0])+">").html(a.html());return a.replaceWith(n),n}return{apply:n,refreshButton:l,refreshDropdown:i}},t.FroalaEditor.DefineIcon("paragraphFormatExt",{NAME:"paragraph"}),t.FroalaEditor.RegisterCommand("paragraphFormatExt",{type:"dropdown",title:"Paragraph Format",plugin:"paragraphFormatExt",displaySelection:function(t){return t.opts.paragraphFormatExtSelection},defaultSelection:"Format",displaySelectionWidth:100,html:function(){for(var e='<ul class="fr-dropdown-list">',r=this.opts.paragraphFormatExt,n=0;n<r.length;++n){var i=t.extend({},r[n]);i.title=this.language.translate(i.title);var l=i.tag||this.html.defaultTag(),o=a(i);e+="<li><"+l+(i["class"]?' class="'+i["class"]+'"':"")+' style="padding: 0 !important; margin: 0 !important;"><a class="fr-command" data-cmd="paragraphFormatExt" data-param1="'+o+'" title="'+i.title+'">'+i.title+"</a></"+l+"></li>"}return e+"</ul>"},callback:function(t,a){this.paragraphFormatExt.apply(a)},refresh:function(t){this.paragraphFormatExt.refreshButton(t)},refreshOnShow:function(t,a){this.paragraphFormatExt.refreshDropdown(a)}})}(jQuery);